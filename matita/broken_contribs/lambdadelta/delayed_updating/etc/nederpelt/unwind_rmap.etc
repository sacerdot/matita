(**************************************************************************)
(*       ___                                                              *)
(*      ||M||                                                             *)
(*      ||A||       A project by Andrea Asperti                           *)
(*      ||T||                                                             *)
(*      ||I||       Developers:                                           *)
(*      ||T||         The HELM team.                                      *)
(*      ||A||         http://helm.cs.unibo.it                             *)
(*      \   /                                                             *)
(*       \ /        This file is distributed under the terms of the       *)
(*        v         GNU General Public License Version 2                  *)
(*                                                                        *)
(**************************************************************************)

include "delayed_updating/syntax/path.ma".
include "delayed_updating/notation/relations/white_righttriangle_6.ma".
include "ground/relocation/tr_map.ma".
include "ground/arith/nat_succ.ma".
(* include "ground/notation/functions/element_e_0.ma". *)
include "ground/notation/functions/black_halfcircleright_3.ma".

(* TAILED NEDERPELT UNWIND FOR RELOCATION MAP *******************************)

inductive stack: Type[0] :=
| stack_empty: stack
| stack_lcons: nat â†’ nat â†’ stack â†’ stack
.

interpretation
  "empty (stack)"
  'ElementE = (stack_empty).

interpretation
  "left cons (stack)"
  'BlackHalfCircleRight d h s = (stack_lcons d h s).

inductive unwind_rmap (f): relation5 path nat nat stack tr_map â‰
| ur_L_succ (q) (m) (n) (s) (g):
  unwind_rmap f q m n s g â†’ unwind_rmap f (qâ—–ğ—Ÿ) (â†‘m) n s g
| ur_A_succ (q) (m) (n) (s) (g):
  unwind_rmap f q (â†‘m) n s g â†’ unwind_rmap f (qâ—–ğ—”) (â†‘m) n s g
| ur_S_succ (q) (m) (n) (s) (g):
  unwind_rmap f q (â†‘m) n s g â†’ unwind_rmap f (qâ—–ğ—¦) (â†‘m) n s g
| ur_d_succ (q) (m) (n) (s) (g) (k:pnat):
  unwind_rmap f q k (ğŸ) (â¨â†‘m,nâ©â——s) g â†’ unwind_rmap f (qâ—–ğ—±k) (â†‘m) n s g
| ur_m (q) (m) (n) (s) (g):
  unwind_rmap f q m n s g â†’ unwind_rmap f (qâ—–ğ—º) m n s g
| ur_L_zero (q) (n) (s) (g):
  unwind_rmap f q (ğŸ) (â†‘â†‘n) s g â†’ unwind_rmap f (qâ—–ğ—Ÿ) (ğŸ) (â†‘n) s g
| ur_A_zero (q) (n) (s) (g):
  unwind_rmap f q (ğŸ) n s g â†’ unwind_rmap f (qâ—–ğ—”) (ğŸ) (â†‘n) s g
| ur_d_zero (q) (n) (s) (g) (k:pnat):
  unwind_rmap f q (ğŸ) (â†‘n) s g â†’ unwind_rmap f (qâ—–ğ—±k) (ğŸ) (â†‘n) s g
| ur_lcons (q) (m) (n) (s) (g):
  unwind_rmap f q m n s g â†’ unwind_rmap f q (ğŸ) (ğŸ) (â¨m,nâ©â——s) g
| ur_empty (q):
  unwind_rmap f q (ğŸ) (ğŸ) (ğ) f
.

interpretation
  "tailed nederpelt unwind (relocation map)"
  'WhiteRightTriangle f m n s p g = (unwind_rmap f p m n s g).
