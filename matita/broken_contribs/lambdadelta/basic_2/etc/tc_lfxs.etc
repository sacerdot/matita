(* lfxs_pair_repl_dx is not generic enough **********************************)

fact tc_lfxs_pair_repl_dx_aux: âˆ€R. (âˆ€L. reflexive â€¦ (R L)) â†’
                               âˆ€I,L1,Y,V1,T. L1.â“‘{I}V1 â¦»**[R, T] Y â†’
                               âˆ€L2,V2. Y = L2.â“‘{I}V2 â†’
                               L1.â“‘{I}V1 â¦»**[R, T] L2.â“‘{I}V1.
#R #HR #I #L1 #Y #V1 #T #H elim H -Y
/3 width=6 by lfxs_pair_repl_dx, step, inj/
#Y #Y2 #HY #HY2 #IH #L2 #V2 #H destruct
elim (lfxs_fwd_dx â€¦ HY2) #L #V #H destruct
lapply (IH ???) [4: |*: // ] -IH #HL1
@(step â€¦ HL1) -HL1 //

/3 width=6 by lfxs_pair_repl_dx, step, inj/

lemma tc_lfxs_pair_repl_dx: âˆ€R. (âˆ€L. reflexive â€¦ (R L)) â†’
                            âˆ€I,L1,L2,V1,V2,T.
                            L1.â“‘{I}V1 â¦»**[R, T] L2.â“‘{I}V2 â†’
                            L1.â“‘{I}V1 â¦»**[R, T] L2.â“‘{I}V1.

(* does this really hold? ***************************************************)

lemma pippo1: âˆ€R. s_r_confluent1 â€¦ R (lfxs R) â†’
              s_r_transitive â€¦ R (lfxs R) â†’
              s_r_transitive â€¦ R (tc_lfxs R).
#R #H1R #H2R @s_r_trans_LTC2 @s_r_trans_LTC1 //
qed-.

definition s_r_confluent2: âˆ€A,B. relation2 (Aâ†’relation B) (Bâ†’relation A) â‰ Î»A,B,R1,R2.
                           âˆ€L2,T1,T2. R1 L2 T1 T2 â†’ âˆ€L1. R2 T1 L1 L2 â†’ R2 T2 L1 L2.


axiom s_r_conf2_LTC2: âˆ€R. s_r_transitive â€¦ R (lfxs R) â†’
                      s_r_confluent1 â€¦ R (lfxs R) â†’
                      s_r_confluent2 â€¦ R (tc_lfxs R).
(*
#R #H1R #H2R #L2 #T1 #T2 #HT12 #L1 #H
@(TC_ind_dx ??????? H) -L1 /3 width=3 by inj/
#L1 #L #HL1 #HL2 #IH @(tc_lfxs_step_sn â€¦ IH) -IH //
*)

lemma tc_lfxs_inv_zero: âˆ€R,Y1,Y2. Y1 âª¤**[R, #0] Y2 â†’
                        âˆ¨âˆ¨ Y1 = â‹† âˆ§ Y2 = â‹†
                         | âˆƒâˆƒI,L1,L2,V1,V2. L1 âª¤**[R, V1] L2 & R L1 V1 V2 &
                                            Y1 = L1.â“‘{I}V1 & Y2 = L2.â“‘{I}V2
                         | âˆƒâˆƒf,I,L1,L2. ğˆâ¦ƒfâ¦„ & L1 âª¤*[cext2 R, cfull, f] L2 &
                                        Y1 = L1.â“¤{I} & Y2 = L2.â“¤{I}.
#R #Y1 #Y2 #H elim H -Y2
[
| #Y #Y2 #_ #H elim (lfxs_inv_zero â€¦ H) -H *
  [ #H #H2 * * /3 width=9 by or3_intro0, or3_intro1, or3_intro2, ex4_5_intro, ex4_4_intro, conj/
  | #I #L #L2 #V #V2 #HL2 #HV2 #H #H2 * *
    [ #H1 #H0 destruct
    | #I0 #L0 #L1 #V0 #V1 #HL01 #HV01 #H1 #H0 destruct  


lemma tc_lfxs_inv_zero: âˆ€R. s_r_confluent1 â€¦ R (lfxs R) â†’
                        s_r_transitive â€¦ R (lfxs R) â†’
                        âˆ€Y1,Y2. Y1 â¦»**[R, #0] Y2 â†’
                        (Y1 = â‹† âˆ§ Y2 = â‹†) âˆ¨
                        âˆƒâˆƒI,L1,L2,V1,V2. L1 â¦»**[R, V1] L2 & LTC â€¦ R L1 V1 V2 &
                                         Y1 = L1.â“‘{I}V1 & Y2 = L2.â“‘{I}V2.
#R #H1R #H2R #Y1 #Y2 #H elim H -Y2
[ #Y2 #H elim (lfxs_inv_zero â€¦ H) -H *
  /4 width=9 by ex4_5_intro, inj, or_introl, or_intror, conj/
| #Y #Y2 #_ #H elim (lfxs_inv_zero â€¦ H) -H *
  [ #H #H2 * * /3 width=9 by ex4_5_intro, or_introl, or_intror, conj/
  | #I #L #L2 #V #V2 #HL2 #HV2 #H #H2 * *
    [ #H1 #H0 destruct
    | #I0 #L1 #L0 #V1 #V0 #HL10 #HV10 #H1 #H0 destruct
      @or_intror @ex4_5_intro [6,7: |*: /width=7/ ]
      [
      | -HL2 @(trans_TC â€¦ HV10) @(pippo1 â€¦ HV2) // -V2 @pippo2 //
      
      lapply (H2R â€¦ HV2 â€¦ HL2) -HL2 #HL02
      /4 width=8 by ex3_5_intro, step, or_intror/
    ]
  ]
] 
qed-.

(* has no meaning without the former ****************************************)

lemma lfxs_inv_lref: âˆ€R,Y1,Y2,i. Y1 â¦»*[R, #â«¯i] Y2 â†’
                     (Y1 = â‹† âˆ§ Y2 = â‹†) âˆ¨
                     âˆƒâˆƒI,L1,L2,V1,V2. L1 â¦»*[R, #i] L2 &
                                      Y1 = L1.â“‘{I}V1 & Y2 = L2.â“‘{I}V2.
#R #Y1 #Y2 #i * #f #H1 #H2 elim (frees_inv_lref â€¦ H1) -H1 *
[ #H #_ lapply (lexs_inv_atom1_aux â€¦ H2 H) -H2 /3 width=1 by or_introl, conj/
| #I1 #L1 #V1 #g #HV1 #HY1 #Hg elim (lexs_inv_push1_aux â€¦ H2 â€¦ HY1 Hg) -H2 -Hg
  /4 width=8 by ex3_5_intro, ex2_intro, or_intror/
]
qed-.

(****************************************************************************)

lemma lfxs_inv_zero_pair_sn: âˆ€R,I,Y2,L1,V1. L1.â“‘{I}V1 â¦»*[R, #0] Y2 â†’
                             âˆƒâˆƒL2,V2. L1 â¦»*[R, V1] L2 & R L1 V1 V2 &
                                      Y2 = L2.â“‘{I}V2.
#R #I #Y2 #L1 #V1 #H elim (lfxs_inv_zero â€¦ H) -H *
[ #H destruct
| #J #Y1 #L2 #X1 #V2 #HV1 #HV12 #H1 #H2 destruct
  /2 width=5 by ex3_2_intro/
]
qed-.

lemma lfxs_inv_zero_pair_dx: âˆ€R,I,Y1,L2,V2. Y1 â¦»*[R, #0] L2.â“‘{I}V2 â†’
                             âˆƒâˆƒL1,V1. L1 â¦»*[R, V1] L2 & R L1 V1 V2 &
                                      Y1 = L1.â“‘{I}V1.
#R #I #Y1 #L2 #V2 #H elim (lfxs_inv_zero â€¦ H) -H *
[ #_ #H destruct
| #J #L1 #Y2 #V1 #X2 #HV1 #HV12 #H1 #H2 destruct
  /2 width=5 by ex3_2_intro/
]
qed-.

lemma lfxs_inv_lref_pair_sn: âˆ€R,I,Y2,L1,V1,i. L1.â“‘{I}V1 â¦»*[R, #â«¯i] Y2
â†’
                             âˆƒâˆƒL2,V2. L1 â¦»*[R, #i] L2 & Y2 = L2.â“‘{I}V2.
#R #I #Y2 #L1 #V1 #i #H elim (lfxs_inv_lref â€¦ H) -H *
[ #H destruct
| #J #Y1 #L2 #X1 #V2 #Hi #H1 #H2 destruct /2 width=4 by ex2_2_intro/
]
qed-.

lemma lfxs_inv_lref_pair_dx: âˆ€R,I,Y1,L2,V2,i. Y1 â¦»*[R, #â«¯i] L2.â“‘{I}V2
â†’
                             âˆƒâˆƒL1,V1. L1 â¦»*[R, #i] L2 & Y1 = L1.â“‘{I}V1.
#R #I #Y1 #L2 #V2 #i #H elim (lfxs_inv_lref â€¦ H) -H *
[ #_ #H destruct
| #J #L1 #Y2 #V1 #X2 #Hi #H1 #H2 destruct /2 width=4 by ex2_2_intro/
]
qed-.
