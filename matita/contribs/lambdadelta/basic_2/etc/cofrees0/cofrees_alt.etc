(**************************************************************************)
(*       ___                                                              *)
(*      ||M||                                                             *)
(*      ||A||       A project by Andrea Asperti                           *)
(*      ||T||                                                             *)
(*      ||I||       Developers:                                           *)
(*      ||T||         The HELM team.                                      *)
(*      ||A||         http://helm.cs.unibo.it                             *)
(*      \   /                                                             *)
(*       \ /        This file is distributed under the terms of the       *)
(*        v         GNU General Public License Version 2                  *)
(*                                                                        *)
(**************************************************************************)

include "basic_2/relocation/lift_neg.ma".
include "basic_2/relocation/lift_lift.ma".
include "basic_2/substitution/cpys.ma".
include "basic_2/substitution/cofrees_lift.ma".

(* CONTEXT-SENSITIVE EXCLUSION FROM FREE VARIABLES **************************)

(* Alternative definition of frees_ge ***************************************)

(*
lemma cpys_fwd_nlift2: âˆ€G,L,U1,U2. â¦ƒG, Lâ¦„ âŠ¢ U1 â–¶* U2 â†’
                       âˆ€i. (âˆ€T2. â‡§[i, 1] T2 â‰¡ U2 â†’ âŠ¥) â†’
                       (âˆ€T1. â‡§[i, 1] T1 â‰¡ U1 â†’ âŠ¥) âˆ¨
                       âˆƒâˆƒI,K,W,j. j < i & â‡©[j]L â‰¡ K.â“‘{I}W &
                                  (âˆ€V. â‡§[i-j-1, 1] V â‰¡ W â†’ âŠ¥) & (âˆ€T1. â‡§[j, 1] T1 â‰¡ U1 â†’ âŠ¥).
#G #L #U1 #U2 #H elim H -G -L -U1 -U2
[ /3 width=2 by or_introl/
| #I #G #L #K #V1 #V2 #W2 #j #HLK #_ #HVW2 #IHV12 #i #HnW2
  elim (lt_or_ge j i) #Hij
  [ @or_intror (**) @(ex4_4_intro â€¦ HLK) //
    [ #X #HXV elim (lift_trans_le â€¦ HXV â€¦ HVW ?) -V //
      #Y #HXY >minus_plus <plus_minus_m_m /2 width=2 by/
    | -HnW2 /2 width=7 by lift_inv_lref2_be/
    ]
  | elim (lift_split â€¦ HVW2 i j) -HVW2 //
    #X #_ #H elim HnW2 -HnW2 //
  ]
| #a #I #G #L #W1 #W2 #U1 #U2 #_ #_ #IHW12 #IHU12 #i #H elim (nlift_inv_bind â€¦ H) -H
  [ #HnW2 elim (IHW12 â€¦ HnW2) -IHW12 -HnW2 -IHU12
    [ /4 width=9 by nlift_bind_sn, or_introl/
    | * /5 width=9 by nlift_bind_sn, ex4_4_intro, or_intror/
    ]
  | #HnU2 elim (IHU12 â€¦ HnU2) -IHU12 -HnU2 -IHW12
    [ /4 width=9 by nlift_bind_dx, or_introl/
    | * #J #K #W #j @(nat_ind_plus â€¦ j) -j
      [ #_ #H lapply (ldrop_inv_pair1 â€¦ H) -H
        #H destruct /4 width=9 by nlift_bind_sn, or_introl/
      | #j #_ #Hji #HLK #HnW
        lapply (ldrop_inv_drop1_lt â€¦ HLK ?) // -HLK #HLK #HnU1
        <minus_le_minus_minus_comm in HnW;
        /5 width=9 by nlift_bind_dx, monotonic_lt_pred, ex4_4_intro, or_intror/
      ]
    ]
  ]
| #I #G #L #W1 #W2 #U1 #U2 #_ #_ #IHW12 #IHU12 #i #H elim (nlift_inv_flat â€¦ H) -H
  [ #HnW2 elim (IHW12 â€¦ HnW2) -IHW12 -HnW2 -IHU12
    [ /4 width=9 by nlift_flat_sn, or_introl/
    | * /5 width=9 by nlift_flat_sn, ex4_4_intro, or_intror/
    ]
  | #HnU2 elim (IHU12 â€¦ HnU2) -IHU12 -HnU2 -IHW12
    [ /4 width=9 by nlift_flat_dx, or_introl/
    | * /5 width=9 by nlift_flat_dx, ex4_4_intro, or_intror/
  ]
]
qed-.
*)
lemma nlift_frees: âˆ€L,U,i. (âˆ€T. â‡§[i, 1] T â‰¡ U â†’ âŠ¥) â†’ (L âŠ¢ i ~Ïµ ð…*â¦ƒUâ¦„ â†’ âŠ¥).
#L #U #i #HnTU #H elim (cofrees_fwd_lift â€¦ H) -H /2 width=2 by/
qed-.
(*
lemma frees_inv_ge: âˆ€L,U,d,i. d â‰¤ yinj i â†’ (L âŠ¢ i ~Ïµ ð…*[d]â¦ƒUâ¦„ â†’ âŠ¥) â†’
                    (âˆ€T. â‡§[i, 1] T â‰¡ U â†’ âŠ¥) âˆ¨
                    âˆƒâˆƒI,K,W,j. d â‰¤ yinj j & j < i & â‡©[j]L â‰¡ K.â“‘{I}W &
                               (K âŠ¢ i-j-1 ~Ïµ ð…*[yinj 0]â¦ƒWâ¦„ â†’ âŠ¥) & (âˆ€T. â‡§[j, 1] T â‰¡ U â†’ âŠ¥).
#L #U #d #i #Hdi #H @(frees_ind â€¦ H) -U /3 width=2 by or_introl/
#U1 #U2 #HU12 #HU2 *
[ #HnU2 elim (cpy_fwd_nlift2_ge â€¦ HU12 â€¦ HnU2) -HU12 -HnU2 /3 width=2 by or_introl/
  * /5 width=9 by nlift_frees, ex5_4_intro, or_intror/
| * #I2 #K2 #W2 #j2 #Hdj2 #Hj2i #HLK2 #HnW2 #HnU2 elim (cpy_fwd_nlift2_ge â€¦ HU12 â€¦ HnU2) -HU12 -HnU2 /4 width=9 by ex5_4_intro, or_intror/
  * #I1 #K1 #W1 #j1 #Hdj1 #Hj12 #HLK1 #HnW1 #HnU1
  lapply (ldrop_conf_ge â€¦ HLK1 â€¦ HLK2 ?) -HLK2 /2 width=1 by lt_to_le/
  #HK12 lapply (ldrop_inv_drop1_lt â€¦ HK12 ?) /2 width=1 by lt_plus_to_minus_r/ -HK12
  #HK12
  @or_intror @(ex5_4_intro â€¦ HLK1 â€¦ HnU1) -HLK1 -HnU1 /2 width=3 by transitive_lt/
  @(frees_be â€¦ HK12 â€¦ HnW1) /2 width=1 by arith_k_sn/ -HK12 -HnW1
  >minus_plus in âŠ¢ (??(?(?%?)?)??â†’?); >minus_plus in âŠ¢ (??(?(??%)?)??â†’?); >arith_b1 /2 width=1 by/
]
qed-.

lemma frees_ind_ge: âˆ€R:relation4 ynat nat lenv term.
                    (âˆ€d,i,L,U. d â‰¤ yinj i â†’ (âˆ€T. â‡§[i, 1] T â‰¡ U â†’ âŠ¥) â†’ R d i L U) â†’
                    (âˆ€d,i,j,I,L,K,W,U. d â‰¤ yinj j â†’ j < i â†’ â‡©[j]L â‰¡ K.â“‘{I}W â†’ (K âŠ¢ i-j-1 ~Ïµ ð…*[0]â¦ƒWâ¦„ â†’ âŠ¥) â†’ (âˆ€T. â‡§[j, 1] T â‰¡ U â†’ âŠ¥) â†’ R 0 (i-j-1) K W â†’ R d i L U) â†’
                    âˆ€d,i,L,U. d â‰¤ yinj i â†’ (L âŠ¢ i ~Ïµ ð…*[d]â¦ƒUâ¦„ â†’ âŠ¥) â†’ R d i L U.
#R #IH1 #IH2 #d #i #L #U
generalize in match d; -d generalize in match i; -i
@(f2_ind â€¦ rfw â€¦ L U) -L -U
#n #IHn #L #U #Hn #i #d #Hdi #H elim (frees_inv_ge â€¦ H) -H /3 width=2 by/
-IH1 * #I #K #W #j #Hdj #Hji #HLK #HnW #HnU destruct /4 width=12 by ldrop_fwd_rfw/
qed-.
*)
