(**************************************************************************)
(*       ___                                                              *)
(*      ||M||                                                             *)
(*      ||A||       A project by Andrea Asperti                           *)
(*      ||T||                                                             *)
(*      ||I||       Developers:                                           *)
(*      ||T||         The HELM team.                                      *)
(*      ||A||         http://helm.cs.unibo.it                             *)
(*      \   /                                                             *)
(*       \ /        This file is distributed under the terms of the       *)
(*        v         GNU General Public License Version 2                  *)
(*                                                                        *)
(**************************************************************************)

include "basic_2/rt_computation/rdsx.ma".

(* STRONGLY NORMALIZING SELECTED LOCAL ENV.S FOR UNBOUND RT-TRANSITION ******)

(* Basic_2A1: uses: lcosx *)
inductive sdsx (h) (G): rtmap â†’ predicate lenv â‰
| sdsx_atom: âˆ€f. sdsx h G f (â‹†)
| sdsx_push: âˆ€f,I,K. sdsx h G f K â†’ sdsx h G (â«¯f) (K.â“˜{I})
| sdsx_unit: âˆ€f,I,K. sdsx h G f K â†’ sdsx h G (â†‘f) (K.â“¤{I})
| sdsx_pair: âˆ€f,I,K,V. G âŠ¢ â¬ˆ*[h,V] ğ’â¦ƒKâ¦„ â†’
             sdsx h G f K â†’ sdsx h G (â†‘f) (K.â“‘{I}V)
.

interpretation
   "strong normalization for unbound context-sensitive parallel rt-transition on selected entries (local environment)"
   'PRedTySNStrong h f G L = (sdsx h G f L).

(* Basic inversion lemmas ***************************************************)

fact sdsx_inv_push_aux (h) (G):
     âˆ€g,L. G âŠ¢ â¬ˆ*[h,g] ğ’â¦ƒLâ¦„ â†’
     âˆ€f,I,K. g = â«¯f â†’ L = K.â“˜{I} â†’ G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒKâ¦„.
#h #G #g #L * -g -L
[ #f #g #J #L #_ #H destruct
| #f #I #K #HK #g #J #L #H1 #H2 destruct //
| #f #I #K #_ #g #J #L #H #_
  elim (discr_next_push â€¦ H)
| #f #I #K #V #_ #_ #g #J #L #H #_
  elim (discr_next_push â€¦ H)
]
qed-.

lemma sdsx_inv_push (h) (G):
      âˆ€f,I,K. G âŠ¢ â¬ˆ*[h,â«¯f] ğ’â¦ƒK.â“˜{I}â¦„ â†’ G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒKâ¦„.
/2 width=6 by sdsx_inv_push_aux/ qed-.

fact sdsx_inv_unit_aux (h) (G):
     âˆ€g,L. G âŠ¢ â¬ˆ*[h,g] ğ’â¦ƒLâ¦„ â†’
     âˆ€f,I,K. g = â†‘f â†’ L = K.â“¤{I} â†’ G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒKâ¦„.
#h #G #g #L * -g -L
[ #f #g #J #L #_ #H destruct
| #f #I #K #_ #g #J #L #H #_
  elim (discr_push_next â€¦ H)
| #f #I #K #HK #g #J #L #H1 #H2 destruct //
| #f #I #K #V #_ #_ #g #J #L #_ #H destruct
]
qed-.

lemma sdsx_inv_unit (h) (G):
      âˆ€f,I,K. G âŠ¢ â¬ˆ*[h,â†‘f] ğ’â¦ƒK.â“¤{I}â¦„ â†’ G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒKâ¦„.
/2 width=6 by sdsx_inv_unit_aux/ qed-.

fact sdsx_inv_pair_aux (h) (G):
     âˆ€g,L. G âŠ¢ â¬ˆ*[h,g] ğ’â¦ƒLâ¦„ â†’
     âˆ€f,I,K,V. g = â†‘f â†’ L = K.â“‘{I}V â†’
     âˆ§âˆ§ G âŠ¢ â¬ˆ*[h,V] ğ’â¦ƒKâ¦„ & G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒKâ¦„.
#h #G #g #L * -g -L
[ #f #g #J #L #W #_ #H destruct
| #f #I #K #_ #g #J #L #W #H #_
  elim (discr_push_next â€¦ H)
| #f #I #K #_ #g #J #L #W #_ #H destruct
| #f #I #K #V #HV #HK #g #J #L #W #H1 #H2 destruct
  /2 width=1 by conj/
]
qed-.

(* Basic_2A1: uses: lcosx_inv_pair *)
lemma sdsx_inv_pair (h) (G):
      âˆ€f,I,K,V. G âŠ¢ â¬ˆ*[h,â†‘f] ğ’â¦ƒK.â“‘{I}Vâ¦„ â†’
      âˆ§âˆ§ G âŠ¢ â¬ˆ*[h,V] ğ’â¦ƒKâ¦„ & G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒKâ¦„.
/2 width=6 by sdsx_inv_pair_aux/ qed-.

(* Advanced inversion lemmas ************************************************)

lemma sdsx_inv_pair_gen (h) (G):
      âˆ€g,I,K,V. G âŠ¢ â¬ˆ*[h,g] ğ’â¦ƒK.â“‘{I}Vâ¦„ â†’
      âˆ¨âˆ¨ âˆƒâˆƒf. G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒKâ¦„ & g = â«¯f
       | âˆƒâˆƒf. G âŠ¢ â¬ˆ*[h,V] ğ’â¦ƒKâ¦„ & G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒKâ¦„ & g = â†‘f.
#h #G #g #I #K #V #H
elim (pn_split g) * #f #Hf destruct
[ lapply (sdsx_inv_push â€¦ H) -H /3 width=3 by ex2_intro, or_introl/
| elim (sdsx_inv_pair â€¦ H) -H /3 width=3 by ex3_intro, or_intror/
]
qed-.

(* Advanced forward lemmas **************************************************)

lemma sdsx_fwd_bind (h) (G):
      âˆ€g,I,K. G âŠ¢ â¬ˆ*[h,g] ğ’â¦ƒK.â“˜{I}â¦„ â†’ G âŠ¢ â¬ˆ*[h,â«±g] ğ’â¦ƒKâ¦„.
#h #G #g #I #K
elim (pn_split g) * #f #Hf destruct
[ #H lapply (sdsx_inv_push â€¦ H) -H //
| cases I -I #I
  [ #H lapply (sdsx_inv_unit â€¦ H) -H //
  | #V #H elim (sdsx_inv_pair â€¦ H) -H //
  ]
]
qed-.

(* Basic properties *********************************************************)

lemma sdsx_eq_repl_back (h) (G):
      âˆ€L. eq_repl_back â€¦ (Î»f. G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒLâ¦„).
#h #G #L #f1 #H elim H -L -f1
[ //
| #f1 #I #L #_ #IH #x2 #H
  elim (eq_inv_px â€¦ H) -H /3 width=3 by sdsx_push/
| #f1 #I #L #_ #IH #x2 #H
  elim (eq_inv_nx â€¦ H) -H /3 width=3 by sdsx_unit/
| #f1 #I #L #V #HV #_ #IH #x2 #H
  elim (eq_inv_nx â€¦ H) -H /3 width=3 by sdsx_pair/
]
qed-.

lemma sdsx_eq_repl_fwd (h) (G):
      âˆ€L. eq_repl_fwd â€¦ (Î»f. G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒLâ¦„).
#h #G #L @eq_repl_sym /2 width=3 by sdsx_eq_repl_back/
qed-.

(* Advanced properties ******************************************************)

(* Basic_2A1: uses: lcosx_O *)
lemma sdsx_isid (h) (G):
      âˆ€f. ğˆâ¦ƒfâ¦„ â†’ âˆ€L. G âŠ¢ â¬ˆ*[h,f] ğ’â¦ƒLâ¦„.
#h #G #f #Hf #L elim L -L
/3 width=3 by sdsx_eq_repl_back, sdsx_push, eq_push_inv_isid/
qed.

(* Basic_2A1: removed theorems 2:
              lcosx_drop_trans_lt lcosx_inv_succ
*)
