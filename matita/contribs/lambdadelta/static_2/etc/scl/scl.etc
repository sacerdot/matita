(**************************************************************************)
(*       ___                                                              *)
(*      ||M||                                                             *)
(*      ||A||       A project by Andrea Asperti                           *)
(*      ||T||                                                             *)
(*      ||I||       Developers:                                           *)
(*      ||T||         The HELM team.                                      *)
(*      ||A||         http://helm.cs.unibo.it                             *)
(*      \   /                                                             *)
(*       \ /        This file is distributed under the terms of the       *)
(*        v         GNU General Public License Version 2                  *)
(*                                                                        *)
(**************************************************************************)

include "static_2/notation/relations/clearsn_3.ma".
include "static_2/syntax/cext2.ma".
include "static_2/relocation/sex.ma".

(* CLEAR FOR LOCAL ENVIRONMENTS ON SELECTED ENTRIES *************************)

definition ccl: relation3 lenv bind bind â‰ Î»L,I1,I2. BUnit Void = I2.

definition scl: rtmap â†’ relation lenv â‰ sex ccl (cext2 ceq).

interpretation
  "clear (local environment)"
  'ClearSn f L1 L2 = (scl f L1 L2).

(* Basic eliminators ********************************************************)

lemma scl_ind (Q:rtmapâ†’relation lenv): 
      (âˆ€f. Q f (â‹†) (â‹†)) â†’
      (âˆ€f,I,K1,K2. K1 âŠâ“§[f] K2 â†’ Q f K1 K2 â†’ Q (â«¯f) (K1.â“˜{I}) (K2.â“˜{I})) â†’
      (âˆ€f,I,K1,K2. K1 âŠâ“§[f] K2 â†’ Q f K1 K2 â†’ Q (â†‘f) (K1.â“˜{I}) (K2.â“§)) â†’
      âˆ€f,L1,L2. L1 âŠâ“§[f] L2 â†’ Q f L1 L2.
#Q #IH1 #IH2 #IH3 #f #L1 #L2 #H elim H -f -L1 -L2 
[ //
| #f #I1 #I2 #K1 #K2 #HK #H #IH destruct /2 by/
| #f #I1 #I2 #K1 #K2 #HK * #I [| #V1 #V2 #H ] #IH destruct /2 by/
]
qed-.

(* Basic inversion lemmas ***************************************************)

lemma scl_inv_atom_sn: âˆ€g,L2. â‹† âŠâ“§[g] L2 â†’ L2 = â‹†.
/2 width=4 by sex_inv_atom1/ qed-.

lemma scl_inv_push_sn: âˆ€f,I,K1,L2. K1.â“˜{I} âŠâ“§[â«¯f] L2 â†’
                       âˆƒâˆƒK2. K1 âŠâ“§[f] K2 & L2 = K2.â“˜{I}.
#f #I #K1 #L2 #H
elim (sex_inv_push1 â€¦ H) -H #J #K2 #HK12 *
/2 width=3 by ex2_intro/
qed-.

lemma scl_inv_next_sn: âˆ€f,I,K1,L2. K1.â“˜{I} âŠâ“§[â†‘f] L2 â†’
                       âˆƒâˆƒK2. K1 âŠâ“§[f] K2 & L2 = K2.â“§.
#f #I #K1 #L2 #H
elim (sex_inv_next1 â€¦ H) -H
/2 width=3 by ex2_intro/
qed-.

(* Advanced inversion lemmas ************************************************)

lemma scl_inv_bind_sn_gen: âˆ€g,I,K1,L2. K1.â“˜{I} âŠâ“§[g] L2 â†’
                           âˆ¨âˆ¨ âˆƒâˆƒf,K2. K1 âŠâ“§[f] K2 & g = â«¯f & L2 = K2.â“˜{I}
                            | âˆƒâˆƒf,K2. K1 âŠâ“§[f] K2 & g = â†‘f & L2 = K2.â“§.
#g #I #K1 #L2 #H
elim (pn_split g) * #f #Hf destruct
[ elim (scl_inv_push_sn â€¦ H) -H
| elim (scl_inv_next_sn â€¦ H) -H
]
/3 width=5 by ex3_2_intro, or_intror, or_introl/
qed-.

(* Advanced forward lemmas **************************************************)

lemma scl_fwd_bind_sn: âˆ€g,I1,K1,L2. K1.â“˜{I1} âŠâ“§[g] L2 â†’
                       âˆƒâˆƒI2,K2. K1 âŠâ“§[â«±g] K2 & L2 = K2.â“˜{I2}.
#g #I1 #K1 #L2
elim (pn_split g) * #f #Hf destruct #H
[ elim (scl_inv_push_sn â€¦ H) -H
| elim (scl_inv_next_sn â€¦ H) -H
]
/2 width=4 by ex2_2_intro/
qed-.

(* Basic properties *********************************************************)

lemma scl_atom: âˆ€f. â‹† âŠâ“§[f] â‹†.
/by sex_atom/ qed.

lemma scl_push: âˆ€f,K1,K2. K1 âŠâ“§[f] K2 â†’ âˆ€I. K1.â“˜{I} âŠâ“§[â«¯f] K2.â“˜{I}.
#f #K1 #K2 #H * /3 width=1 by sex_push, ext2_unit, ext2_pair/
qed.

lemma scl_next: âˆ€f,K1,K2. K1 âŠâ“§[f] K2 â†’ âˆ€I. K1.â“˜{I} âŠâ“§[â†‘f] K2.â“§.
/2 width=1 by sex_next/ qed.

lemma scl_eq_repl_back: âˆ€L1,L2. eq_repl_back â€¦ (Î»f. L1 âŠâ“§[f] L2).
/2 width=3 by sex_eq_repl_back/ qed-.

lemma scl_eq_repl_fwd: âˆ€L1,L2. eq_repl_fwd â€¦ (Î»f. L1 âŠâ“§[f] L2).
/2 width=3 by sex_eq_repl_fwd/ qed-.

(* Advanced properties ******************************************************)

lemma scl_refl: âˆ€f. ğˆâ¦ƒfâ¦„ â†’ reflexive â€¦ (scl f).
#f #Hf #L elim L -L
/3 width=3 by scl_eq_repl_back, scl_push, eq_push_inv_isid/
qed.
